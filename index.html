<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>An√†lisi Borsa Temps Real + Gr√†fics</title>
  <script>
    async function consultaDades() {
      const apiKey = document.getElementById("apiKey").value;
      const symbols = document.getElementById("symbols").value.split(",").map(s => s.trim().toUpperCase());
      const output = document.getElementById("resultats");
      const grafic = document.getElementById("grafic");
      output.innerHTML = "<strong>Analitzant...</strong><br>";

      for (const symbol of symbols) {
        output.innerHTML += `<hr><strong>${symbol}</strong><br>`;

        try {
          const quoteResp = await fetch(`https://finnhub.io/api/v1/quote?symbol=${symbol}&token=${apiKey}`);
          const quote = await quoteResp.json();
          const canvi = (((quote.c - quote.pc) / quote.pc) * 100).toFixed(2);
          output.innerHTML += `‚≠ê Preu actual: ${quote.c}$ (${canvi}%)<br>`;

          const rsiResp = await fetch(`https://finnhub.io/api/v1/indicator?symbol=${symbol}&resolution=D&indicator=rsi&timeperiod=14&token=${apiKey}`);
          const rsiData = await rsiResp.json();
          const rsi = rsiData.technicalAnalysis?.rsi?.slice(-1)[0];
          if (rsi) {
            output.innerHTML += `üìâ RSI: ${rsi.toFixed(2)} `;
            if (rsi < 30) output.innerHTML += "‚ûî Possible compra (infravalorada)<br>";
            else if (rsi > 70) output.innerHTML += "‚ö† Sobrecomprada<br>";
            else output.innerHTML += "‚≠ê Neutral<br>";
          } else {
            output.innerHTML += `üìâ RSI: No disponible<br>`;
          }

          const macdResp = await fetch(`https://finnhub.io/api/v1/indicator?symbol=${symbol}&resolution=D&indicator=macd&token=${apiKey}`);
          const macdData = await macdResp.json();
          const macd = macdData.technicalAnalysis?.macd?.macd?.slice(-1)[0];
          const signal = macdData.technicalAnalysis?.macd?.signal?.slice(-1)[0];
          if (macd && signal) {
            output.innerHTML += `üìä MACD: ${macd.toFixed(2)} | Senyal: ${signal.toFixed(2)} `;
            output.innerHTML += (macd > signal) ? "‚Üó Tend√®ncia alcista<br>" : "‚Üò Tend√®ncia baixista<br>";
          } else {
            output.innerHTML += "üìä MACD: No disponible<br>";
          }

          grafic.innerHTML = `<iframe src='https://s.tradingview.com/embed-widget/mini-symbol-overview/?symbol=NASDAQ%3A${symbol}&locale=es#' width='100%' height='350' frameborder='0' allowtransparency='true' scrolling='no'></iframe>`;

        } catch (e) {
          output.innerHTML += `‚ùå Error amb ${symbol}: ${e.message}<br>`;
        }
      }
    }
  </script>
</head>
<body style="font-family: sans-serif; padding: 2rem; max-width: 800px; margin: auto;">
  <h2>‚öñÔ∏è An√†lisi de Borsa Temps Real + Gr√†fic</h2>
  <p>Introdueix la teva <strong>clau API de Finnhub</strong> i els t√≠ckets de les accions separats per comes.</p>

  <label>API Key: <input id="apiKey" type="text" placeholder="d1cmeipr..." style="width: 100%"></label><br><br>
  <label>Accions (ex: OXY, NVDA, GOOGL): <input id="symbols" type="text" value="OXY, NVDA, GOOGL" style="width: 100%"></label><br><br>
  <button onclick="consultaDades()">üìà Inicia An√†lisi</button>

  <div id="resultats" style="margin-top: 2rem; white-space: pre-wrap;"></div>
  <div id="grafic" style="margin-top: 2rem;"></div>
</body>
</html>
